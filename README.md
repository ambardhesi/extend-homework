## Extend-Homework 
Extend-Homework is a simple wrapper over 3 of Extend's developer APIs, implemented as a REST API server.

## Build
```
make certs
```
This will generated keys and certs for the CA, Ambar (me!) and a bad client for testing.

```
$ make binaries
```

This will create the `extend-homework` (CLI client) and `extend-homework-client` (Server) binaries.

## Server
Start the server by following the build step, then running `./extend-homework-server`.

This will start up the server on localhost at port 8080. The server address is currently hardcoded inside runnable/main.go.

The server provides the following endpoints : 
* GET `/cards` to get all the cards for a user 
* GET `/cards/:id/transactions` to get all transactions for a card
* GET `/transactions/:id` to get the details of an individual transaction

To interact with the server, use the provided CLI Client (preferred), or use any tool to make REST calls (eg curl, Postman).

Sample call : 
```
curl --cert certs/bob-cert.pem --key certs/bob-key.pem --cacert certs/ca-cert.pem https://localhost:8080/cards/vc_7H4qGbKL9Fl8u8xVs3uksj/transactions

```

## Client
The `./extend-homework-client` binary provides a CLI interface for making calls to the server.

Run `./extend-homework-client --help` for usage instructions.

### Signing in
```
$ ./extend-homework-client --ca certs/ca-cert.pem --cert certs/ambar-cert.pem --key certs/ambar-key.pem  foo@foo.com my-password

```

### Getting all virtual cards
```
$ ./extend-homework-client cards --ca certs/ca-cert.pem --cert certs/ambar-cert.pem --key certs/ambar-key.pem 
{
	"virtual_cards": [
		{
			"id": "vc_7H4qGbKL9Fl8u8xVs3uksj",
			"status": "ACTIVE",
			"balanceCents": 4000,
			"issuer": {
				"id": "iss_3IwK5YZpJOt6Jx7XoeaawR",
				"name": "Comdata"
			}
		}
	]
}

```

### Getting all transactions for a card
```
$ ./extend-homework-client card-transactions vc_7H4qGbKL9Fl8u8xVs3uksj --ca certs/ca-cert.pem --cert certs/ambar-cert.pem --key certs/ambar-key.pem 
{
	"transactions": [
		{
			"id": "txn_0DqkSDD3ksl8uOYCOvHszf",
			"cardholderName": "Sarah Sanzari",
			"recipientName": "Ambar Dhesi",
			"status": "PENDING",
			"authBillingAmountCents": 1000,
			"merchantName": "SSP* ELEPHANT SANCTUAR 931-7966500   TN"
		}
	]
}

```

### Getting metadata about an individual transaction
```
$ ./extend-homework-client transaction txn_0DqkSDD3ksl8uOYCOvHszf --ca certs/ca-cert.pem --cert certs/ambar-cert.pem --key certs/ambar-key.pem 
{
	"transaction": {
		"id": "txn_0DqkSDD3ksl8uOYCOvHszf",
		"cardholderName": "Sarah Sanzari",
		"recipientName": "Ambar Dhesi",
		"status": "PENDING",
		"authBillingAmountCents": 1000,
		"merchantName": "SSP* ELEPHANT SANCTUAR 931-7966500   TN"
	}
}

```

## Design decisions

### Programming language, infrastructure, libraries etc
* Extend-Homework is built using Go for its simplicity, ease of development, and personal learning goals!
* The only way of running the server currently is by using the Go compiler. This is made easier by the use of Makefile commands like `make binaries`. In the future, this could be abstracted away to use containers for ease of deployment on other machines.
* Libraries used are `gin-gonic/gin` for the HTTP framework and middleware, `go-resty/resty` for a Fluent HTTP client, and `spf13/cobra` for creating the CLI application.

### Authentication
The client and server authenticate each other using mTLS (over TLS 1.3). A Certificate Authority that both the client and server trust is created, the public/private keys for which are committed to the Git repository for ease of use and implementation. 

Public/private keys for 2 users (Ambar and Bob) and the server are generated by using the CA as the signator. 

### Authorization
The AuthZ model is simple - the access token retrieved when first logging in is stored in an in-memory database, keyed by the user's email address. This email address _must_ match the CN of the client certificate.

Each request requires a client certificate, which contains the user's email address. This email address is used to look up the access token from the in-memory DB. If it is expired, the refresh token (also stored in an in-memory DB) is used to refresh it. If no token exists, the request is denied, with the understanding that the user must first log in.

